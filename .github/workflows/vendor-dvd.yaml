name: Vendor DVD CI

on:
  pull_request: {}
  push:
    branches:
    - main
  schedule:
    # Run weekly (04:45 AM UTC on Thursdays) to catch failures based on
    # external changes.
    - cron: '45 04 * * 4'
  workflow_dispatch: {}

jobs:
  main:
    name: Build
    runs-on: ubuntu-22.04
    defaults:
      run:
        working-directory: vendor-dvd

    steps:
    - name: Check out sources
      uses: actions/checkout@v4

    - name: Run shellcheck
      run: |
        shellcheck --version
        shellcheck *.sh tests/*.sh ../boot-dvd/internal/vars.sh

    - name: Make ISO using mock inputs
      run: ./make-iso.sh
      env:
        USE_MOCK_INPUTS: '1'

    - name: Check mock ISO
      run: ./tests/test-mock-iso.sh
